<script lang="ts" setup>
import { Mapbox, GeolocateControl, GeoJsonSource, FillLayer } from '@/libs'
import type { MapOptions } from 'maplibre-gl'
import 'maplibre-gl/dist/maplibre-gl.css'

const options = computed<Partial<MapOptions>>(() => ({
  container: 'map',
  style: 'https://worldwidemaps.sqkii.com/api/maps/purple/style.json',
  center: [106.72044, 10.78156],
  zoom: 9
}))

function makeSource(features: any[]) {
  return {
    type: 'geojson',
    data: {
      type: 'FeatureCollection',
      features
    }
  }
}

const data = computed(
  () =>
    makeSource([
      {
        type: 'Feature',
        properties: {},
        geometry: {
          type: 'Polygon',
          coordinates: [
            [
              [106.74105877007571, 11.081035285253408],
              [106.70493758617185, 11.0792917256924],
              [106.66916553568119, 11.074077900421782],
              [106.63408833949975, 11.065444204883802],
              [106.60004492841118, 11.053474083857434],
              [106.56736413490935, 11.038283215921489],
              [106.53636148808909, 11.020018383427805],
              [106.50733614400941, 10.998856039534871],
              [106.48056798231079, 10.97500058690676],
              [106.45631489789848, 10.948682385560376],
              [106.43481031422597, 10.9201555100133],
              [106.41626094216505, 10.889695278317559],
              [106.40084480567612, 10.857595577738241],
              [106.3887095525391, 10.824166013730737],
              [106.37997106531505, 10.789728910472256],
              [106.37471238452665, 10.754616192502587],
              [106.37298295281123, 10.719166178018893],
              [106.37479818555488, 10.683720315048607],
              [106.38013937029059, 10.648619892093645],
              [106.38895389397392, 10.614202754902848],
              [106.40115579415955, 10.580800060794374],
              [106.41662662711838, 10.548733101424782],
              [106.43521664307515, 10.518310224097625],
              [106.4567462560315, 10.489823880633718],
              [106.48100779308102, 10.463547831502067],
              [106.50776750573563, 10.43973453134909],
              [106.53676782357758, 10.418612720280906],
              [106.56772982853737, 10.400385243265662],
              [106.60035592628405, 10.385227117848599],
              [106.63433268960928, 10.373283868030422],
              [106.66933384729607, 10.364670139669974],
              [106.70502339079327, 10.359468610155643],
              [106.74105877007571, 10.357729202368452],
              [106.77709414935816, 10.359468610155643],
              [106.81278369285533, 10.364670139669974],
              [106.84778485054213, 10.373283868030422],
              [106.88176161386737, 10.385227117848599],
              [106.91438771161404, 10.400385243265662],
              [106.94534971657383, 10.418612720280906],
              [106.97435003441579, 10.43973453134909],
              [107.00110974707039, 10.463547831502067],
              [107.02537128411991, 10.489823880633718],
              [107.04690089707628, 10.518310224097625],
              [107.06549091303305, 10.548733101424782],
              [107.08096174599187, 10.580800060794374],
              [107.0931636461775, 10.614202754902847],
              [107.10197816986081, 10.648619892093645],
              [107.10731935459654, 10.683720315048607],
              [107.10913458734021, 10.719166178018893],
              [107.10740515562478, 10.754616192502587],
              [107.10214647483639, 10.789728910472256],
              [107.09340798761234, 10.824166013730737],
              [107.08127273447529, 10.857595577738241],
              [107.06585659798635, 10.889695278317559],
              [107.04730722592545, 10.9201555100133],
              [107.02580264225294, 10.948682385560376],
              [107.00154955784062, 10.97500058690676],
              [106.97478139614199, 10.998856039534871],
              [106.94575605206232, 11.020018383427805],
              [106.91475340524207, 11.038283215921489],
              [106.88207261174023, 11.053474083857434],
              [106.84802920065165, 11.065444204883802],
              [106.81295200447022, 11.074077900421782],
              [106.77717995397956, 11.0792917256924],
              [106.74105877007571, 11.081035285253408]
            ]
          ]
        }
      }
    ]) as any
)

watchEffect(() => {
  console.log('data.valuexxx mkkee', data.value)
})
</script>
<template>
  <Mapbox :options="options">
    <GeolocateControl
      :options="{
        positionOptions: {
          enableHighAccuracy: true
        },
        trackUserLocation: true,
        showAccuracyCircle: false
      }" />
    <GeoJsonSource :data="data">
      <FillLayer
        :style="{
          'fill-color': '#088'
        }" />
    </GeoJsonSource>
  </Mapbox>
</template>
