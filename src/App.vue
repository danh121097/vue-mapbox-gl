<script lang="ts" setup>
import { MapBox, GeoControl, Layer } from '@components';
import { ref } from 'vue';
import { computed } from '@vue/reactivity';
import { Map } from 'mapbox-gl';
import type { AnySourceData } from 'mapbox-gl';
import '../dist/style.css';

const mapContainer = ref<Map | null>(null);

function onMapIntialized(map: Map) {
  if (!map) return;
  mapContainer.value = map;
}

function onMapIntializing() {
  console.log('intializing');
}

function onMapClick(value: unknown) {
  console.log('value', value);
}

const sourceData = computed(() => {
  return {
    type: 'Feature',
    properties: {},
    geometry: {
      type: 'Polygon',
      coordinates: [
        [
          [101.655193, 3.2653830909311345],
          [101.6331200398316, 3.2643002419135554],
          [101.61125979265934, 3.2610621302512515],
          [101.58982291731122, 3.255699961326551],
          [101.56901598430483, 3.248265409130561],
          [101.54903948155177, 3.2388301172271117],
          [101.53008587932386, 3.227485006932117],
          [101.5123377732925, 3.2143393994537215],
          [101.49596612366103, 3.199519960546568],
          [101.48112860743771, 3.183169477954096],
          [101.46796809975807, 3.1654454835290755],
          [101.45661129887269, 3.1465187334187714],
          [101.44716750798393, 3.1265715610630216],
          [101.43972758556058, 3.105796118968343],
          [101.43436307409864, 3.084392526278056],
          [101.43112551554742, 3.0625669400479105],
          [101.43004595980088, 3.040529568851351],
          [101.43113467078233, 3.0184926478725695],
          [101.4343810327458, 2.996668394994728],
          [101.43975365749388, 2.975266967552969],
          [101.4472006912927, 2.954494439396262],
          [101.45665031836165, 2.934550817689889],
          [101.46801145594925, 2.9156281184938604],
          [101.48117463419163, 2.8979085195761596],
          [101.49601305220327, 2.8815626081688492],
          [101.51238380018546, 2.8667477404572046],
          [101.53012923577198, 2.8536065285155963],
          [101.54907850137644, 2.842265469178977],
          [101.56904916797694, 2.8328337279769236],
          [101.5898489895802, 2.8254020897709253],
          [101.6112777515634, 2.820042086138852],
          [101.63312919520556, 2.8168053078583193],
          [101.655193, 2.815722909068865],
          [101.67725680479442, 2.8168053078583193],
          [101.69910824843656, 2.820042086138852],
          [101.72053701041978, 2.8254020897709253],
          [101.74133683202302, 2.8328337279769236],
          [101.76130749862352, 2.842265469178977],
          [101.78025676422799, 2.8536065285155963],
          [101.7980021998145, 2.8667477404572046],
          [101.81437294779671, 2.8815626081688492],
          [101.82921136580833, 2.8979085195761596],
          [101.84237454405071, 2.9156281184938604],
          [101.85373568163833, 2.9345508176898885],
          [101.86318530870727, 2.954494439396262],
          [101.8706323425061, 2.975266967552969],
          [101.87600496725419, 2.996668394994728],
          [101.87925132921764, 3.0184926478725695],
          [101.88034004019909, 3.040529568851351],
          [101.87926048445254, 3.0625669400479096],
          [101.87602292590134, 3.084392526278056],
          [101.87065841443939, 3.1057961189683425],
          [101.86321849201605, 3.1265715610630216],
          [101.85377470112729, 3.1465187334187714],
          [101.84241790024191, 3.1654454835290755],
          [101.82925739256225, 3.183169477954096],
          [101.81441987633893, 3.199519960546568],
          [101.79804822670748, 3.2143393994537215],
          [101.78030012067612, 3.227485006932117],
          [101.7613465184482, 3.2388301172271117],
          [101.74137001569514, 3.248265409130561],
          [101.72056308268876, 3.255699961326551],
          [101.69912620734063, 3.2610621302512515],
          [101.67726596016837, 3.2643002419135554],
          [101.655193, 3.2653830909311345]
        ]
      ]
    }
  };
}) as unknown as AnySourceData;
</script>

<template>
  <div class="container">
    <MapBox
      class="map"
      :mapbox-options="{
        accessToken:
          'pk.eyJ1IjoibG5uZHV5IiwiYSI6ImNrdzYweTAzajZqMmYyb28wYnJlM285bTIifQ.OuhH3LpSwz3F6ez20qizBQ',
        style: 'https://worldwidemaps.sqkii.com/api/maps/purple/style.json',
        container: 'mapContainer'
      }"
      @map-intialized="(map: Map) => onMapIntialized(map)"
      @map-intializing="onMapIntializing"
    >
      <GeoControl
        :geolocate-control-options="{
          positionOptions: {
            enableHighAccuracy: true
          },
          trackUserLocation: true,
          showUserHeading: false,
          showAccuracyCircle: false
        }"
      />
      <Layer
        :source-data="{
          type: 'geojson',
          data: sourceData as any
        }"
        source-id="brand"
        :layer-config="[
          {
            id: 'brand_line_layer',
            type: 'fill',
            source: 'brand',
            paint: {
              'fill-color': '#f4f4f4'
            }
          }
        ]"
        @on-map-layer-click="onMapClick"
      />
    </MapBox>
  </div>
</template>
<style>
* {
  margin: 0;
  padding: 0;
  font-family: inherit;
  box-sizing: inherit;
}
.container {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.map {
  height: 500px;
  width: 500px;
}
</style>
