<script lang="ts" setup>
import { MapBox, GeoControl, Layer, Marker, PopUp } from '@components';
import { ref } from 'vue';
import { Map } from 'mapbox-gl';
import type { Geometry } from 'geojson';
import '../dist/style.css';

const mapContainer = ref<Map | null>(null);

function onMapIntialized(map: Map) {
  if (!map) return;
  mapContainer.value = map;
}

function onMapIntializing() {
  console.log('intializing');
}

function onMapClick(value: unknown) {
  console.log('value', value);
}

const sourceData = ref({
  type: 'FeatureCollection',
  features: [
    {
      type: 'Feature',
      properties: {},
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [103.81583516595906, 24.727694714940622],
            [103.34414551269805, 24.705966973091208],
            [102.87745592824044, 24.641015590847292],
            [102.4206961137686, 24.53353269867782],
            [101.97865703910442, 24.384660624350786],
            [101.55592646219975, 24.19597543044567],
            [101.15682997480269, 23.969464584424507],
            [100.78537889248373, 23.707499419917415],
            [100.44522592512588, 23.412803159090437],
            [100.1396291590225, 23.088415330812392],
            [99.87142448744895, 22.737653438067298],
            [99.64300627197437, 22.36407270479779],
            [99.45631572366028, 21.971424674264],
            [99.31283627492897, 21.56361534713497],
            [99.21359507397099, 21.14466344774694],
            [99.15916967118721, 20.718659300854142],
            [99.1496989724712, 20.289724697264145],
            [99.1848975943121, 19.861974031848792],
            [99.26407285590003, 19.439476916477766],
            [99.386143768499, 19.026222406375275],
            [99.54966151818522, 18.626084932338948],
            [99.75283107241424, 18.24279200266995],
            [99.99353366400015, 17.879893725752087],
            [100.26935001081867, 17.5407342042558],
            [100.57758421135138, 17.228424861608314],
            [100.91528831296064, 16.945819777058475],
            [101.27928758156801, 16.69549312377482],
            [101.66620651007084, 16.47971882159529],
            [102.07249559170799, 16.300452529401113],
            [102.49445885811414, 16.15931610933936],
            [102.92828214511322, 16.05758469473354],
            [103.370062007848, 15.996176484774134],
            [103.81583516595906, 15.975645372072407],
            [104.26160832407012, 15.996176484774134],
            [104.70338818680493, 16.05758469473354],
            [105.137211473804, 16.15931610933936],
            [105.55917474021012, 16.30045252940111],
            [105.9654638218473, 16.47971882159529],
            [106.35238275035012, 16.695493123774824],
            [106.7163820189575, 16.945819777058475],
            [107.05408612056674, 17.228424861608307],
            [107.36232032109946, 17.5407342042558],
            [107.63813666791798, 17.879893725752087],
            [107.87883925950389, 18.24279200266995],
            [108.08200881373293, 18.626084932338948],
            [108.24552656341915, 19.026222406375275],
            [108.3675974760181, 19.43947691647776],
            [108.44677273760604, 19.861974031848792],
            [108.48197135944694, 20.289724697264145],
            [108.47250066073092, 20.718659300854142],
            [108.41807525794715, 21.14466344774694],
            [108.31883405698915, 21.563615347134963],
            [108.17535460825783, 21.971424674264],
            [107.98866405994377, 22.36407270479779],
            [107.76024584446918, 22.737653438067298],
            [107.49204117289563, 23.088415330812392],
            [107.18644440679225, 23.412803159090437],
            [106.8462914394344, 23.707499419917415],
            [106.47484035711544, 23.969464584424507],
            [106.07574386971837, 24.19597543044567],
            [105.6530132928137, 24.384660624350786],
            [105.21097421814954, 24.533532698677817],
            [104.75421440367768, 24.641015590847292],
            [104.28752481922007, 24.705966973091208],
            [103.81583516595906, 24.727694714940622]
          ]
        ]
      }
    }
  ]
}) as any;
</script>

<template>
  <div class="container">
    <MapBox
      class="map"
      :mapbox-options="{
        accessToken:
          'pk.eyJ1IjoidHV2dSIsImEiOiJjbGd4YzlqY2IwMGtuM2dsa3V3ZWFmcmpyIn0.D3vTYJfFQh1ZJ2Pyz-Z3qw',
        style: 'https://worldwidemaps.sqkii.com/api/maps/purple/style.json',
        container: 'mapContainer',
        center: [108.47067944725364, 14.37145041099869]
      }"
      @intialized="(map: Map) => onMapIntialized(map)"
      @intializing="onMapIntializing"
      @click="onMapClick"
    >
      <GeoControl
        :geolocate-control-options="{
          positionOptions: {
            enableHighAccuracy: true
          },
          trackUserLocation: true,
          showUserHeading: false,
          showAccuracyCircle: false
        }"
      />
      <Layer
        :source-data="{
          type: 'geojson',
          data: sourceData as unknown as Geometry
        }"
        source-id="circle"
        :layer-config="[
          {
            id: 'circle_layer',
            type: 'fill',
            paint: {
              'fill-color': '#f4f4f4',
              'fill-opacity': 0.3
            }
          }
        ]"
      />
      <Marker :lng-lat="[108.47067944725364, 14.37145041099869]" />
      <PopUp
        :lng-lat="[108.47067944725364, 14.37145041099869]"
        content="Hello World"
      />
    </MapBox>
  </div>
</template>
<style>
* {
  margin: 0;
  padding: 0;
  font-family: inherit;
  box-sizing: inherit;
}
.container {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.map {
  height: 500px;
  width: 500px;
}
</style>
