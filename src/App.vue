<script lang="ts" setup>
import { MapBox, GeoControl, Layer } from '@components';
import { onMounted, ref } from 'vue';
import { Map } from 'mapbox-gl';
import type { Geometry } from 'geojson';
import '../dist/style.css';

const mapContainer = ref<Map | null>(null);

function onMapIntialized(map: Map) {
  if (!map) return;
  mapContainer.value = map;
}

function onMapIntializing() {
  console.log('intializing');
}

function onMapClick(value: unknown) {
  console.log('value', value);
}

const sourceData = ref({
  type: 'FeatureCollection',
  features: [
    {
      type: 'Feature',
      properties: {},
      geometry: {
        type: 'Polygon',
        coordinates: [
          [
            [103.81583516595906, 24.727694714940622],
            [103.34414551269805, 24.705966973091208],
            [102.87745592824044, 24.641015590847292],
            [102.4206961137686, 24.53353269867782],
            [101.97865703910442, 24.384660624350786],
            [101.55592646219975, 24.19597543044567],
            [101.15682997480269, 23.969464584424507],
            [100.78537889248373, 23.707499419917415],
            [100.44522592512588, 23.412803159090437],
            [100.1396291590225, 23.088415330812392],
            [99.87142448744895, 22.737653438067298],
            [99.64300627197437, 22.36407270479779],
            [99.45631572366028, 21.971424674264],
            [99.31283627492897, 21.56361534713497],
            [99.21359507397099, 21.14466344774694],
            [99.15916967118721, 20.718659300854142],
            [99.1496989724712, 20.289724697264145],
            [99.1848975943121, 19.861974031848792],
            [99.26407285590003, 19.439476916477766],
            [99.386143768499, 19.026222406375275],
            [99.54966151818522, 18.626084932338948],
            [99.75283107241424, 18.24279200266995],
            [99.99353366400015, 17.879893725752087],
            [100.26935001081867, 17.5407342042558],
            [100.57758421135138, 17.228424861608314],
            [100.91528831296064, 16.945819777058475],
            [101.27928758156801, 16.69549312377482],
            [101.66620651007084, 16.47971882159529],
            [102.07249559170799, 16.300452529401113],
            [102.49445885811414, 16.15931610933936],
            [102.92828214511322, 16.05758469473354],
            [103.370062007848, 15.996176484774134],
            [103.81583516595906, 15.975645372072407],
            [104.26160832407012, 15.996176484774134],
            [104.70338818680493, 16.05758469473354],
            [105.137211473804, 16.15931610933936],
            [105.55917474021012, 16.30045252940111],
            [105.9654638218473, 16.47971882159529],
            [106.35238275035012, 16.695493123774824],
            [106.7163820189575, 16.945819777058475],
            [107.05408612056674, 17.228424861608307],
            [107.36232032109946, 17.5407342042558],
            [107.63813666791798, 17.879893725752087],
            [107.87883925950389, 18.24279200266995],
            [108.08200881373293, 18.626084932338948],
            [108.24552656341915, 19.026222406375275],
            [108.3675974760181, 19.43947691647776],
            [108.44677273760604, 19.861974031848792],
            [108.48197135944694, 20.289724697264145],
            [108.47250066073092, 20.718659300854142],
            [108.41807525794715, 21.14466344774694],
            [108.31883405698915, 21.563615347134963],
            [108.17535460825783, 21.971424674264],
            [107.98866405994377, 22.36407270479779],
            [107.76024584446918, 22.737653438067298],
            [107.49204117289563, 23.088415330812392],
            [107.18644440679225, 23.412803159090437],
            [106.8462914394344, 23.707499419917415],
            [106.47484035711544, 23.969464584424507],
            [106.07574386971837, 24.19597543044567],
            [105.6530132928137, 24.384660624350786],
            [105.21097421814954, 24.533532698677817],
            [104.75421440367768, 24.641015590847292],
            [104.28752481922007, 24.705966973091208],
            [103.81583516595906, 24.727694714940622]
          ]
        ]
      }
    }
  ]
}) as any;

onMounted(() => {
  setTimeout(() => {
    sourceData.value = {
      type: 'FeatureCollection',
      features: [
        {
          type: 'Feature',
          properties: {},
          geometry: {
            type: 'Polygon',
            coordinates: [
              [
                [108.13256467415908, 14.582311931970434],
                [107.7848972712945, 14.565553829593167],
                [107.4407224686224, 14.515448503439845],
                [107.10349225491738, 14.432500876453686],
                [106.77657818946582, 14.317545797651363],
                [106.46323313404477, 14.17173816024016],
                [106.16655522137121, 13.9965393626385],
                [105.88945464821413, 13.793700389569151],
                [105.63462376290366, 13.56524184500885],
                [105.40451078721016, 13.313431307932442],
                [105.2012973807142, 13.040758404918241],
                [105.02688013048063, 12.74990800141185],
                [104.88285593739087, 12.443731907444976],
                [104.77051117834651, 12.125219476340952],
                [104.69081445407043, 11.797467449388387],
                [104.64441268657131, 11.463649368816345],
                [104.63163030767922, 11.126984848769125],
                [104.65247127789553, 10.790708962147397],
                [104.70662368936745, 10.45804197243959],
                [104.793466733529, 10.132159615668895],
                [104.91207984793371, 9.816164119295834],
                [105.06125389318854, 9.513056132624328],
                [105.23950424525599, 9.225707736603086],
                [105.4450857169831, 8.956836698986153],
                [105.67600924271157, 8.708982142280268],
                [105.93006026941787, 8.484481795137018],
                [106.20481879630877, 8.28545100108213],
                [106.49768099250689, 8.113763659969312],
                [106.80588230074072, 7.971035275725321],
                [107.12652190597537, 7.858608277538844],
                [107.45658841448667, 7.777539769769716],
                [107.7929865541708, 7.728591848129289],
                [108.13256467415908, 7.712224596237084],
                [108.47214279414739, 7.728591848129289],
                [108.80854093383151, 7.777539769769716],
                [109.1386074423428, 7.858608277538844],
                [109.45924704757745, 7.9710352757253204],
                [109.7674483558113, 8.113763659969312],
                [110.06031055200941, 8.28545100108213],
                [110.3350690789003, 8.484481795137018],
                [110.58912010560661, 8.708982142280266],
                [110.82004363133508, 8.956836698986153],
                [111.02562510306218, 9.225707736603086],
                [111.20387545512965, 9.513056132624326],
                [111.35304950038447, 9.816164119295834],
                [111.47166261478918, 10.132159615668895],
                [111.55850565895074, 10.458041972439585],
                [111.61265807042264, 10.790708962147397],
                [111.63349904063895, 11.126984848769125],
                [111.62071666174685, 11.463649368816343],
                [111.57431489424773, 11.797467449388387],
                [111.49461816997166, 12.12521947634095],
                [111.38227341092731, 12.443731907444977],
                [111.23824921783753, 12.74990800141185],
                [111.06383196760397, 13.040758404918241],
                [110.86061856110803, 13.313431307932442],
                [110.63050558541451, 13.565241845008847],
                [110.37567470010406, 13.793700389569148],
                [110.09857412694697, 13.9965393626385],
                [109.80189621427341, 14.171738160240157],
                [109.48855115885236, 14.317545797651363],
                [109.16163709340078, 14.432500876453686],
                [108.82440687969577, 14.515448503439845],
                [108.48023207702367, 14.565553829593167],
                [108.13256467415908, 14.582311931970434]
              ]
            ]
          }
        }
      ]
    };
  }, 5000);
});
</script>

<template>
  <div class="container">
    <MapBox
      class="map"
      :mapbox-options="{
        accessToken:
          'pk.eyJ1IjoidHV2dSIsImEiOiJjbGd4YzlqY2IwMGtuM2dsa3V3ZWFmcmpyIn0.D3vTYJfFQh1ZJ2Pyz-Z3qw',
        style: 'https://worldwidemaps.sqkii.com/api/maps/purple/style.json',
        container: 'mapContainer',
        center: [108.47067944725364, 14.37145041099869]
      }"
      @map-intialized="(map: Map) => onMapIntialized(map)"
      @map-intializing="onMapIntializing"
    >
      <GeoControl
        :geolocate-control-options="{
          positionOptions: {
            enableHighAccuracy: true
          },
          trackUserLocation: true,
          showUserHeading: false,
          showAccuracyCircle: false
        }"
      />
      <Layer
        :source-data="{
          type: 'geojson',
          data: sourceData as unknown as Geometry
        }"
        source-id="circle"
        :layer-config="[
          {
            id: 'circle_layer',
            type: 'fill',
            paint: {
              'fill-color': '#f4f4f4',
              'fill-opacity': 0.3
            }
          }
        ]"
        @on-map-layer-click="onMapClick"
      />
    </MapBox>
  </div>
</template>
<style>
* {
  margin: 0;
  padding: 0;
  font-family: inherit;
  box-sizing: inherit;
}
.container {
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.map {
  height: 500px;
  width: 500px;
}
</style>
